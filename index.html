<!-- html 코드로 검은 테두리의 정사각형을 3*3으로 분할한 모양을 만들고, 색상 9개를 입력하여 각 칸에 채운 뒤 복사하면 정사각형 이미지를 복사할 수 있게 해줘 -->
<!doctype html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title>색상 채우기 및 복사 예제</title>
        <style>
            body {
                font-family: sans-serif;
                display: flex;
                flex-direction: column;
                align-items: center;
                margin: 30px;
            }
            canvas {
                border: 0px solid black;
                box-sizing: border-box;
                margin-bottom: 10px;
            }
            button.color-input {
                border: 10px solid black;
                border-radius: 10px;
                width: 75px;
                height: 75px;
                margin: 5px;
                font-size: 20px;
                color: black;
                text-shadow:
                    -1px -1px 0 white,
                    1px -1px 0 white,
                    -1px 1px 0 white,
                    1px 1px 0 white;
                margin: 0;
            }
            button.reset-input {
                border: 10px solid black;
                border-radius: 10px;
                width: 75px;
                height: 75px;
                margin: 5px;
                font-size: 15px;
                text-align: center;
                background-color: #d8d4d3;
                color: black;
                margin: 0;
            }
            button.clear-input {
                border: 10px solid black;
                border-radius: 10px;
                width: 75px;
                height: 75px;
                margin: 5px;
                font-size: 15px;
                text-align: center;
                background-color: #d8d4d3;
                color: black;
                margin: 0;
            }
        </style>
    </head>
    <body>
        <canvas id="colorCanvas" width="300" height="300"></canvas>
        <table>
            <tr>
                <td><button class="color-input" value="R" style="background-color: #e30929">R</button></td>
                <td><button class="color-input" value="Y" style="background-color: #ffff05">Y</button></td>
                <td><button class="color-input" value="G" style="background-color: #07a23a">G</button></td>
            </tr>
            <tr>
                <td><button class="color-input" value="O" style="background-color: #ef7d05">O</button></td>
                <td><button class="color-input" value="W" style="background-color: #ffffff">W</button></td>
                <td><button class="color-input" value="B" style="background-color: #0354a1">B</button></td>
            </tr>
            <tr>
                <td><button class="color-input" value="X" style="background-color: #958b87">X</button></td>
                <td><button class="color-input" value="L" style="background-color: #d8d4d3">L</button></td>
                <td><button class="color-input" value="K" style="background-color: #000000">K</button></td>
            </tr>
            <tr>
                <td><button class="reset-input" id="resetBtn">RESET</button></td>
                <td><button class="clear-input" id="clearBtn">CLEAR</button></td>
            </tr>
        </table>

        <input type="text" id="color-input" value="" maxlength="9" pattern="[ROYWGBXLK]{0,9}" oninput="this.value = this.value.toUpperCase().replace(/[^ROYWGBXLK]/g, '')" />
        <!-- <input type="text" id="addit-input" value="" maxlength="4" pattern="[0-7]{0,4}" /> -->
        <!-- <input type="text" id="aclor-input" value="" maxlength="12" pattern="[ROYWGBXLK]{0,12}" oninput="this.value = this.value.toUpperCase().replace(/[^ROYWGBXLK]/g, '')" /> -->
        <div><br /></div>
        <button id="fillAndCopyBtn">복사</button>
        <script>
            const colorTable = {
                R: "#E30929",
                O: "#EF7D05",
                Y: "#FFFF05",
                W: "#FFFFFF",
                G: "#07A23A",
                B: "#0354A1",
                X: "#958B87",
                L: "#D8D4D3",
                K: "#000000",
            };
            const canvas = document.getElementById("colorCanvas");
            const ctx = canvas.getContext("2d", { alpha: true });

            const colorInput = document.getElementById("color-input");
            const additInput = document.getElementById("addit-input");
            const aClorInput = document.getElementById("aclor-input");

            const fillAndCopyBtn = document.getElementById("fillAndCopyBtn");

            const gridSize = 3;
            const cellSize = 75;
            const wpadSize = (canvas.width - gridSize * cellSize) / 2;
            const hpadSize = (canvas.width - gridSize * cellSize) / 2;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "rgba(255, 255, 255, 50)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            function drawGrid() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                for (let i = 0; i < gridSize; i++) {
                    for (let j = 0; j < gridSize; j++) {
                        const index = i * gridSize + j;
                        ctx.beginPath();
                        ctx.fillStyle = colorTable[colorInput.value.charAt(index).toUpperCase()] ?? colorTable["X"];
                        console.log(ctx.fillStyle);
                        ctx.roundRect(wpadSize + j * cellSize, hpadSize + i * cellSize, cellSize, cellSize, 10);
                        ctx.fill();
                        ctx.closePath();

                        console.log(colorInput.value.charAt(index));
                    }
                }
                ctx.lineJoin = "round";
                ctx.lineCap = "round";
                ctx.lineWidth = 10;
                for (let i = 0; i < gridSize; i++) {
                    for (let j = 0; j < gridSize; j++) {
                        ctx.strokeRect(wpadSize + j * cellSize, hpadSize + i * cellSize, cellSize, cellSize);
                    }
                }
                // for (let i = 0; i < 4; i++) {
                //     additInput.value
                //         .charAt(i)
                //         .toString(2)
                //         .padStart(3, "0")
                //         .map((bit) => bit === "1");
                //     [-0, 0, 0, cellSize / 2];
                //     [-cellSize / 2, 0, 0, cellSize];
                //     ctx.strokeRect(wpadSize + j * cellSize - cellSize / 2, hpadSize + i * cellSize, cellSize, cellSize);
                // }
            }

            drawGrid();

            colorInput.addEventListener("input", drawGrid);

            async function copyCanvasToClipboard() {
                try {
                    const blob = await new Promise((resolve) => canvas.toBlob(resolve, "image/png"));
                    const item = new ClipboardItem({ "image/png": blob });
                    await navigator.clipboard.write([item]);
                } catch (err) {
                    console.error(err);
                }
            }

            fillAndCopyBtn.addEventListener("click", () => {
                drawGrid();
                copyCanvasToClipboard();
            });

            document.addEventListener("keydown", (e) => {
                if (e.ctrlKey && e.key === "c") {
                    copyCanvasToClipboard();
                    e.preventDefault();
                }
            });

            //각 버튼을 누르면 버튼의 값이 텍스트인풋에 들어감, 리셋 누르면 텍스트 인풋 초기화, 지우기 누르면 하나 지워짐            const colorButtons = document.querySelectorAll(".color-input");
            const resetBtn = document.getElementById("resetBtn");
            const clearBtn = document.getElementById("clearBtn");
            const colorButtons = document.querySelectorAll(".color-input");

            colorButtons.forEach((button) => {
                button.addEventListener("click", () => {
                    if (colorInput.value.length < 9) {
                        colorInput.value += button.value;
                        drawGrid();
                    }
                });
            });

            resetBtn.addEventListener("click", () => {
                colorInput.value = "";
                drawGrid();
            });

            clearBtn.addEventListener("click", () => {
                colorInput.value = colorInput.value.slice(0, -1);
                drawGrid();
            });
        </script>
    </body>
</html>
